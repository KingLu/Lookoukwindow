<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Permissions-Policy" content="accelerometer=*, autoplay=*, clipboard-write=*, encrypted-media=*, fullscreen=*, gyroscope=*, picture-in-picture=*, web-share=*">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöÄ</text></svg>">
    <title>{% block title %}Lookoukwindow{% endblock %}</title>
    <script>
        // [Critical Fix] Monkey patch addEventListener to suppress 'unload' handlers
        // This must run before ANY other script to catch early registrations
        (function() {
            const originalAddEventListener = EventTarget.prototype.addEventListener;
            EventTarget.prototype.addEventListener = function(type, listener, options) {
                if (type === 'unload') {
                    // Silently ignore 'unload' event registration
                    return;
                }
                return originalAddEventListener.call(this, type, listener, options);
            };

            // Also suppress console errors aggressively at the very top
            const originalError = console.error;
            const originalWarn = console.warn;
            
            console.error = function(...args) {
                const msg = args.join(' ');
                if (msg.includes('inspector.js') || 
                    msg.includes('XMLHttpRequest') || 
                    msg.includes('responseText') || 
                    msg.includes('InvalidStateError')) return;
                originalError.apply(console, args);
            };

            console.warn = function(...args) {
                const msg = args.join(' ');
                if (msg.includes('Permissions policy violation') ||
                    msg.includes('unload is not allowed')) return;
                originalWarn.apply(console, args);
            };
        })();
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
        }
        
        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
        }
        
        /* ÊµÆÂä®ÊéßÂà∂ÊåâÈíÆ - ÊÇ¨ÊµÆÂú®Áõ∏ÂÜåÂè≥‰∏äËßí */
        .floating-controls {
            position: fixed;
            top: 15px;
            right: 430px; /* Áõ∏ÂÜåÂÆΩÂ∫¶ 400px + ËæπË∑ù */
            z-index: 1000;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .floating-controls.visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        .floating-btn {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.9);
            padding: 8px 14px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .floating-btn:hover {
            background: rgba(0, 0, 0, 0.8);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .floating-btn svg {
            width: 14px;
            height: 14px;
            fill: currentColor;
        }
        
        /* ÂìçÂ∫îÂºèÔºöÂ†ÜÂè†Â∏ÉÂ±ÄÊó∂Ë∞ÉÊï¥‰ΩçÁΩÆ */
        .layout-stacked .floating-controls {
            right: 20px;
        }
        
        .content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        .main-content {
            flex: 1;
            position: relative;
        }
        
        .sidebar {
            width: 400px;
            background: linear-gradient(135deg, #0a0a0a 0%, #111 100%);
            border-left: 1px solid rgba(255, 255, 255, 0.08);
            overflow: hidden;
            padding: 20px 15px;
            display: flex;
            flex-direction: column;
        }
        
        .layout-side-by-side .main-content {
            width: 60%;
        }
        
        .layout-side-by-side .sidebar {
            width: 40%;
        }
        
        .layout-stacked .content {
            flex-direction: column;
        }
        
        .layout-stacked .main-content {
            height: 60%;
        }
        
        .layout-stacked .sidebar {
            width: 100%;
            height: 40%;
            padding: 15px 20px;
        }
        
        .youtube-container {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        .youtube-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .photo-container {
            width: 100%;
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .photo-image {
            max-width: calc(100% - 10px);
            max-height: calc(100% - 80px); /* ‰∏∫Â∫ïÈÉ®‰ø°ÊÅØÊ°ÜÁïôÁ©∫Èó¥ */
            object-fit: contain;
            border-radius: 6px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .photo-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            z-index: 0;
            pointer-events: none;
        }

        .photo-wrapper.active {
            opacity: 1;
            z-index: 1;
            pointer-events: auto;
        }

        .photo-video {
            max-width: calc(100% - 10px);
            max-height: calc(100% - 80px);
            object-fit: contain;
            border-radius: 6px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        /* Transition Effects */
        /* Slide Left */
        .transition-slide-left .photo-wrapper { transition: transform 0.8s ease-in-out, opacity 0.8s; }
        .transition-slide-left .photo-wrapper.enter { transform: translateX(100%); opacity: 0; }
        .transition-slide-left .photo-wrapper.active { transform: translateX(0); opacity: 1; }
        .transition-slide-left .photo-wrapper.exit { transform: translateX(-100%); opacity: 0; }

        /* Slide Right */
        .transition-slide-right .photo-wrapper { transition: transform 0.8s ease-in-out, opacity 0.8s; }
        .transition-slide-right .photo-wrapper.enter { transform: translateX(-100%); opacity: 0; }
        .transition-slide-right .photo-wrapper.active { transform: translateX(0); opacity: 1; }
        .transition-slide-right .photo-wrapper.exit { transform: translateX(100%); opacity: 0; }

        /* Slide Up */
        .transition-slide-up .photo-wrapper { transition: transform 0.8s ease-in-out, opacity 0.8s; }
        .transition-slide-up .photo-wrapper.enter { transform: translateY(100%); opacity: 0; }
        .transition-slide-up .photo-wrapper.active { transform: translateY(0); opacity: 1; }
        .transition-slide-up .photo-wrapper.exit { transform: translateY(-100%); opacity: 0; }

        /* Slide Down */
        .transition-slide-down .photo-wrapper { transition: transform 0.8s ease-in-out, opacity 0.8s; }
        .transition-slide-down .photo-wrapper.enter { transform: translateY(-100%); opacity: 0; }
        .transition-slide-down .photo-wrapper.active { transform: translateY(0); opacity: 1; }
        .transition-slide-down .photo-wrapper.exit { transform: translateY(100%); opacity: 0; }

        /* Zoom In */
        .transition-zoom-in .photo-wrapper { transition: transform 1s ease, opacity 1s; }
        .transition-zoom-in .photo-wrapper.enter { transform: scale(0.8); opacity: 0; }
        .transition-zoom-in .photo-wrapper.active { transform: scale(1); opacity: 1; }
        .transition-zoom-in .photo-wrapper.exit { transform: scale(1.2); opacity: 0; }

        /* Zoom Out */
        .transition-zoom-out .photo-wrapper { transition: transform 1s ease, opacity 1s; }
        .transition-zoom-out .photo-wrapper.enter { transform: scale(1.2); opacity: 0; }
        .transition-zoom-out .photo-wrapper.active { transform: scale(1); opacity: 1; }
        .transition-zoom-out .photo-wrapper.exit { transform: scale(0.8); opacity: 0; }
        
        /* ÁÖßÁâá‰ø°ÊÅØÊ°Ü - Â∫ïÈÉ®Á™ÑÊù°ËÆæËÆ° */
        .photo-metadata {
            position: absolute;
            bottom: 12px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.06);
            color: rgba(255, 255, 255, 0.85);
            z-index: 10;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            pointer-events: none;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .photo-metadata .meta-item {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }
        
        .photo-metadata .meta-icon-img {
            width: 12px;
            height: 12px;
            opacity: 0.7;
        }
        
        .photo-metadata .meta-sep {
            color: rgba(255, 255, 255, 0.3);
            font-size: 0.7rem;
        }

        .photo-metadata.hidden {
            display: none;
        }
        
        .photo-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: rgba(255, 255, 255, 0.8);
            font-size: 18px;
            width: 40px;
            height: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            transition: all 0.2s ease;
            opacity: 0;
        }
        
        .photo-container:hover .photo-nav {
            opacity: 1;
        }
        
        .photo-nav:hover {
            background: rgba(0, 0, 0, 0.6);
            color: #fff;
            transform: translateY(-50%) scale(1.1);
        }
        
        .photo-nav.prev {
            left: 15px;
        }
        
        .photo-nav.next {
            right: 15px;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            font-size: 18px;
        }
        
        .error {
            color: #ff4444;
            padding: 20px;
            text-align: center;
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>
    <div class="container layout-{{ layout }}">
        <div class="content">
            {% block content %}{% endblock %}
        </div>
        
        <!-- ÊµÆÂä®ÊéßÂà∂ÊåâÈíÆ -->
        <div class="floating-controls" id="floating-controls">
            <button class="floating-btn" onclick="toggleFullscreen()" title="ÂàáÊç¢ÂÖ®Â±è">
                <svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
                ÂÖ®Â±è
            </button>
            <button class="floating-btn" onclick="window.location.href='/settings'" title="ÊâìÂºÄËÆæÁΩÆ">
                <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                ËÆæÁΩÆ
            </button>
        </div>
    </div>
    
    <script>
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }
        
        // ÊµÆÂä®ÊåâÈíÆËá™Âä®ÊòæÁ§∫/ÈöêËóèÔºà3ÁßíÊó†Êìç‰ΩúÂêéÈöêËóèÔºâ
        let controlsTimer;
        const floatingControls = document.getElementById('floating-controls');
        
        function showControls() {
            if (floatingControls) {
                floatingControls.classList.add('visible');
                clearTimeout(controlsTimer);
                controlsTimer = setTimeout(() => {
                    floatingControls.classList.remove('visible');
                }, 3000);
            }
        }
        
        document.addEventListener('mousemove', showControls);
        document.addEventListener('touchstart', showControls);
        
        // Èº†Ê†áÊÇ¨ÂÅúÂú®ÊåâÈíÆ‰∏äÊó∂‰øùÊåÅÊòæÁ§∫
        if (floatingControls) {
            floatingControls.addEventListener('mouseenter', () => {
                clearTimeout(controlsTimer);
                floatingControls.classList.add('visible');
            });
            floatingControls.addEventListener('mouseleave', () => {
                controlsTimer = setTimeout(() => {
                    floatingControls.classList.remove('visible');
                }, 1500);
            });
        }
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>
