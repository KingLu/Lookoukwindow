# Lookoukwindow 功能说明文档

> 一款专为树莓派设计的多功能智能信息展示系统，集成 NASA 太空直播、金融数据看板、本地相册轮播和智能生活信息于一体。

---

## 目录

- [产品概述](#产品概述)
- [系统要求](#系统要求)
- [核心功能](#核心功能)
  - [1. NASA 太空直播](#1-nasa-太空直播)
  - [2. 金融信息看板](#2-金融信息看板)
  - [3. 本地相册管理](#3-本地相册管理)
  - [4. 智能生活信息](#4-智能生活信息)
  - [5. 节能休眠模式](#5-节能休眠模式)
- [界面布局](#界面布局)
- [管理后台](#管理后台)
- [使用指南](#使用指南)
  - [首次配置](#首次配置)
  - [相册管理](#相册管理)
  - [金融数据配置](#金融数据配置)
  - [直播频道管理](#直播频道管理)
  - [天气配置](#天气配置)
- [快捷键](#快捷键)
- [常见问题](#常见问题)

---

## 产品概述

Lookoukwindow（"探窗"）是一款为树莓派量身定制的信息展示应用。它的设计理念是：**让一台树莓派连接显示器后，成为您家庭或办公室中的智能信息中心**。

### 适用场景

- 🏠 **家庭客厅**: 作为电子相框展示家庭照片，同时提供时间、天气、财务信息
- 🏢 **办公环境**: 展示实时股票行情和全球指数，辅助投资决策
- 🚀 **太空爱好者**: 实时观看 NASA 太空直播和国际空间站地球直播
- 📺 **数字看板**: 结合 Kiosk 模式实现开机自动全屏展示

---

## 系统要求

| 项目 | 要求 |
|------|------|
| **硬件** | 树莓派 4（推荐）/ 树莓派 3B+ |
| **操作系统** | Ubuntu 20.04+ 或 Raspberry Pi OS |
| **Python** | 3.8 或更高版本 |
| **存储空间** | 至少 2GB 可用空间（用于存储照片） |
| **网络** | 局域网连接（天气、金融数据需要互联网） |

---

## 核心功能

### 1. NASA 太空直播

**功能描述**：实时嵌入播放 YouTube 直播流，默认提供 NASA 官方直播频道。

**预设频道**：
- 🛰️ **NASA TV** - NASA 官方电视频道
- 🌍 **ISS Live** - 国际空间站地球实时直播
- 🚀 **NASA Live** - NASA 官方活动直播

**功能特性**：
- 16:9 完美适配播放窗口
- 支持自定义 YouTube 频道（需提供频道 URL）
- 可设置默认播放频道
- 自动处理 YouTube 嵌入兼容性问题（Referrer-Policy 等）

**使用方式**：
- 访问首页自动播放默认频道
- 在设置页面可更改默认频道或添加自定义频道

---

### 2. 金融信息看板

金融看板采用「价值投资」设计理念，分为**指数滚动栏**和**个股轮播卡片**两部分。

#### 2.1 全球指数滚动栏

**功能描述**：以无缝滚动跑马灯形式展示全球主要市场指数。

**默认指数**：
| 代码 | 名称 | 说明 |
|------|------|------|
| 000001.SS | 上证指数 | 中国 A 股主板 |
| 399001.SZ | 深证成指 | 中国深市 |
| ^IXIC | 纳斯达克 | 美国科技股 |
| ^DJI | 道琼斯 | 美国蓝筹股 |
| ^HSI | 恒生指数 | 香港市场 |
| ^VIX | VIX 恐慌指数 | 市场波动指标 |
| GC=F | 黄金 | 现货黄金 |
| BTC-USD | BTC | 比特币 |
| ETH-USD | ETH | 以太坊 |

**显示信息**：
- 指数名称
- 当前点位
- 涨跌点数及涨跌幅
- **1个月迷你趋势图**（新增于 v0.8）

**颜色规则**（中国股市惯例）：
- 🔴 **红色**：上涨
- 🟢 **绿色**：下跌

#### 2.2 个股轮播卡片

**功能描述**：轮播展示自选股的详细信息，支持持仓管理和目标价设置。

**展示内容**：
| 区域 | 内容 |
|------|------|
| **价格区** | 当前价格（大字）、涨跌额、涨跌幅 |
| **标识区** | 股票名称、代码、类型标签（持仓/观察） |
| **目标价区** | 目标价及距离目标的涨跌幅 |
| **趋势图** | 3年周线 + MA50 均线 |
| **辅助信息** | 成交量、前收、分析师目标价、财报日期 |

**特殊标注**：
- 🔴 **52周最高点** - 图表上红色圆点标注，显示价格和 "52H" 标签
- 🟢 **52周最低点** - 图表上绿色圆点标注，显示价格和 "52L" 标签

**股票类型**：
- **持仓 (Holding)**：显示持仓收益、卖出目标价
- **观察 (Watching)**：显示买入目标价

---

### 3. 本地相册管理

**存储架构**（v0.5 重构）：

```
data/
├── library/        # 原始照片池（不压缩，永久保存）
├── web_images/     # 1280px 压缩版（用于前端展示）
├── thumbnails/     # 400px 缩略图（用于列表预览）
└── albums/         # 相册元数据（仅存储照片 ID 引用）
```

**核心概念**：
- **照片库 (Library)**：所有照片的统一存储池，每张照片有唯一 ID
- **逻辑相册 (Album)**：相册仅作为分组容器，存储照片 ID 引用
- 同一张照片可以加入多个相册，无需复制文件

**功能特性**：
- ✅ 批量上传（支持拖拽）
- ✅ 照片旋转（仅修改展示版，原图保留）
- ✅ SHA-256 去重（相同照片不重复上传）
- ✅ EXIF 元数据自动解析（拍摄时间、GPS、设备）
- ✅ 逆地理编码（GPS 坐标转地名）
- ✅ 相册激活/停用切换
- ✅ 轮播顺序（随机打乱 / 按时间排序）

**切换特效**（v0.5 新增）：
- 淡入淡出 (fade)
- 左滑 (slide-left)
- 缩放 (zoom)
- 上推 (push)

---

### 4. 智能生活信息

#### 4.1 超级日历

**显示内容**：
- 公历日期（年/月/日 星期）
- 实时时间（支持 12h/24h 切换，点击切换）
- 农历日期（如：腊月初八）
- 干支纪年（如：乙巳年）
- 生肖年（如：蛇年）

#### 4.2 实时天气

**数据来源**：Open-Meteo API（免费、无需 API Key）

**显示内容**：
- 当前温度
- 天气图标（☀️🌤️⛅☁️🌧️⛈️等）
- 位置名称（可配置）
- 未来预报（+2h, +4h, +6h, +12h, +24h）

**配置项**：
- 经纬度坐标
- 显示地名

---

### 5. 节能休眠模式

**功能描述**：在指定时间段自动进入休眠状态，节省能耗和保护屏幕。

**休眠状态下**：
- 显示黑底大字时钟（公历、农历、生肖）
- 销毁 YouTube 播放器
- 暂停所有轮播动画和网络请求
- **防烧屏保护**：时钟位置每 5 分钟随机偏移

**配置项**：
- 启用/禁用开关
- 开始时间（如 22:30）
- 结束时间（如 05:30）

**智能唤醒**：时间到达自动恢复直播和数据更新。

---

## 界面布局

首页采用左右分栏布局：

```
┌─────────────────────────────────────────────────────────┐
│  左侧区域（约 70%）              │  右侧区域（约 30%） │
├──────────────────────────────────┼─────────────────────┤
│  ┌──────────────────────────────┐│                     │
│  │ 🕒 日期时间    🌤️ 天气预报  ││                     │
│  └──────────────────────────────┘│                     │
│  ┌──────────────────────────────┐│   📷 照片轮播区    │
│  │                              ││                     │
│  │    🚀 YouTube 直播窗口       ││   （激活相册照片）  │
│  │        (16:9)                ││                     │
│  │                              ││                     │
│  └──────────────────────────────┘│                     │
│  ┌──────────────────────────────┐│                     │
│  │ 📈 指数滚动栏                ││                     │
│  │ 📊 个股轮播卡片              ││                     │
│  └──────────────────────────────┘│                     │
└─────────────────────────────────────────────────────────┘
```

---

## 管理后台

### 访问地址

| 页面 | 路径 | 功能 |
|------|------|------|
| 首页 | `/` | 主展示页面 |
| 登录 | `/login` | 密码登录 |
| 设置 | `/settings` | 综合配置 |
| 照片库 | `/admin/library` | 照片上传/编辑/删除 |
| 相册管理 | `/admin/albums` | 创建/管理相册 |
| 股票配置 | `/admin/stocks` | 自选股配置 |

### 首次访问

首次访问会自动跳转到 `/setup` 页面设置登录密码。

**默认密码**：`Spacewin`（建议首次登录后修改）

---

## 使用指南

### 首次配置

1. 启动应用：`python run.py`
2. 浏览器访问：`http://localhost:8000` 或 `http://<树莓派IP>:8000`
3. 设置登录密码
4. 进入设置页面配置各项参数

### 相册管理

1. 访问 `/settings` 或 `/admin/library`
2. **上传照片**：拖拽或点击上传区域
3. **创建相册**：在相册管理区域点击"新建相册"
4. **添加照片到相册**：进入相册详情，从库中选择照片
5. **激活相册**：开启相册的开关，使其加入轮播列表

### 金融数据配置

#### 配置指数

在设置页面的"金融数据设置"区域，配置指数列表：

```
000001.SS,上证指数
399001.SZ,深证成指
^IXIC,纳斯达克
^DJI,道琼斯
^HSI,香港恒生
^VIX,VIX恐慌
GC=F,黄金
BTC-USD,BTC
ETH-USD,ETH
```

#### 配置自选股

格式：`代码,名称`（每行一个）

```
300253.SZ,卫宁健康
600584.SS,长电科技
1810.HK,小米集团
0981.HK,中芯国际
AAPL,苹果
TSLA,特斯拉
```

#### 高级配置

在 `/admin/stocks` 页面可配置：
- 股票类型（持仓/观察）
- 买入/卖出目标价
- 持仓成本和数量

### 直播频道管理

1. 访问设置页面
2. 在"直播频道"区域可：
   - 选择默认播放频道
   - 添加自定义 YouTube 频道（需提供频道 URL）
   - 删除自定义频道

### 天气配置

在设置页面配置：
- **显示地名**：如"北京市大兴区"
- **经度**：如 116.33
- **纬度**：如 39.73

---

## 快捷键

| 快捷键 | 功能 |
|--------|------|
| `←` | 上一张照片 |
| `→` | 下一张照片 |
| `Esc` | 退出全屏 |
| 点击时间 | 切换 12h/24h 格式 |

---

## 常见问题

### Q1: YouTube 视频无法播放？

**A**: 检查以下几点：
1. 确保网络可以访问 YouTube
2. 应用已自动处理 Referrer-Policy 等兼容性问题
3. 如仍有问题，可能是频道不支持嵌入播放

### Q2: 金融数据不更新？

**A**: 金融数据依赖 `yfinance` 库获取：
- 指数数据每 5 分钟更新一次
- 个股数据随轮播实时获取
- 确保网络可以访问 Yahoo Finance

### Q3: 如何开机自动启动？

**A**: 使用 systemd 服务：

```bash
# 复制服务文件
sudo cp lookoukwindow.service /etc/systemd/system/

# 启用服务
sudo systemctl enable lookoukwindow

# 启动服务
sudo systemctl start lookoukwindow
```

### Q4: 如何配置 Kiosk 模式？

**A**: 运行 Kiosk 脚本：

```bash
./scripts/kiosk.sh
```

该脚本会：
1. 禁用屏幕保护和电源管理
2. 等待服务启动
3. 启动 Chromium/Firefox 全屏模式

### Q5: 树莓派上安装依赖很慢？

**A**: 使用 piwheels 源加速：

```bash
pip install -r requirements.txt --extra-index-url https://www.piwheels.org/simple
```

### Q6: 如何重置密码？

**A**: 运行密码重置脚本：

```bash
python scripts/reset_password.py
```

---

## 版本历史

请参阅 [CHANGELOG.md](../CHANGELOG.md) 获取完整的版本更新记录。

---

## 许可证

本项目采用 GPL-3.0 许可证开源。

