# 更新日志 (Changelog)

所有项目的显著更改都将记录在此文件中。

## [v0.8.0] - 2025-12-06

### 新增功能 (Features)

- **指数卡片全面升级**:
  - 每个指数卡片现在显示完整信息：中文名称、当前点位、涨跌点数、涨跌幅度
  - 新增 **1个月迷你趋势图**，直观展示近期走势
  - 卡片采用渐变背景 + 阴影效果，支持 hover 交互
  - 颜色遵循中国股市惯例：**红涨绿跌**

- **52周高低点可视化**:
  - 52周数据从辅助信息栏移至趋势图上直接标注
  - 🔴 **52周最高点**：红色圆点 + 价格 + "52H" 标签
  - 🟢 **52周最低点**：绿色圆点 + 价格 + "52L" 标签
  - 鼠标悬停显示完整日期信息

### 重构 (Refactoring)

- **股票卡片布局重构**:
  - 采用 "左侧核心信息 + 右侧图表" 分栏布局
  - 建立清晰的视觉层次：
    - L1: 当前价格（2.2rem 大字）+ 涨跌幅（紧贴显示）
    - L2: 股票名称 + 代码 + 类型标签
    - L3: 目标价对比区
  - 辅助信息（成交量、前收、分析师目标价、财报日期）移至图表下方水平排列
  - **移除估值仪表盘**，简化界面

### 优化 (Optimizations)

- **布局紧凑度优化**:
  - 左侧信息区从百分比布局改为固定 140px 宽度
  - 移除垂直居中，信息从顶部紧凑排列
  - 图表区占据更大空间（约80%）
  - 消除中间大面积空白

- **目标价显示优化**:
  - 移除"买入目标/卖出目标"文字标签
  - 百分比改为：从当前价到目标价所需的涨跌幅
  - 买入目标显示负百分比（如 `▼ -32.0%`，表示需下跌）
  - 卖出目标显示正百分比（如 `▲ +40.3%`，表示需上涨）

- **标签完整化**:
  - "分析师" → "分析师目标价"

### 修复 (Fixes)

- 修复 pandas datetime 时区不匹配导致历史数据获取失败的问题
- 修复辅助信息栏水平对齐问题

### 技术改进 (Technical)

- 后端 API 新增 `year_high_date` 和 `year_low_date` 字段
- 前端 Chart.js 使用自定义插件绘制高低点标注
- 优化指数卡片跑马灯动画时长（60s）

## [v0.7.0] - 2025-12-03

### 重大变更 (Breaking Changes)

- **存储架构重构**:
  - `data/library` 目录现在存放用户上传的**原始照片**（不做任何压缩处理）
  - `data/web_images` 目录存放 1280px 压缩优化版（用于前端展示）
  - `data/thumbnails` 目录存放 400px 缩略图（用于列表预览）
  - **旋转操作不再修改原图**，只更新展示版，原图永久保留

### 新增功能 (Features)

- **日志系统增强**:
  - 新增应用级日志配置系统
  - 相册管理操作（创建、删除）添加日志记录
  - 设置更新添加日志记录
  - YouTube 自定义频道管理添加日志记录
  - 照片删除操作添加详细日志，便于排查问题

- **照片库管理改进**:
  - 新增**全选/取消全选**按钮，方便批量操作
  - 删除照片时**自动清理所有相册中的引用**
  - 自动更新受影响相册的封面

### 修复 (Fixes)

- 修复轮播特效不遵循用户设置的问题（之前强制使用随机特效）
- 修复财报日历获取崩溃的问题
- 修复批量删除按钮不显示的问题
- 直接切换(none)模式下立即移除旧元素，减少资源占用

### 优化 (Optimizations)

- **Chromium Kiosk 模式启动参数优化**:
  - 禁用扩展和后台组件
  - 禁用默认应用和翻译功能
  - 减少树莓派资源占用

## [v0.6.1] - 2025-12-01

### 修复 (Fixes)

- 修复 Kiosk 启动脚本弹窗和自动播放问题
- 优化直播自动播放逻辑
- 改进小屏设备显示适配

## [v0.6.0] - 2025-11-30

### 新增功能 (Features)

- **高级金融数据追踪**:
  - 新增买入/卖出目标价设置
  - 新增持仓成本和数量配置
  - 新增估值仪表盘可视化
  - 支持持仓盈亏计算和显示
  - 新增 52 周高低点、成交量等扩展指标

- **直播频道管理**:
  - 设置页面新增"设置默认直播频道"功能
  - 支持从预设和自定义频道中选择默认播放源

### 优化 (Optimizations)

- 相册信息图标显示优化，使用本地 SVG 替代 Emoji，提升兼容性

## [v0.5.1] - 2025-11-29

### 修复 (Fixes)

- 修复了 Web 优化图生成参数错误的问题

## [v0.5.0] - 2025-11-29

### 重大变更 (Breaking Changes)

- **相册架构重构**:
  - 引入 "照片库 (Library) + 逻辑相册" 的新架构。所有照片统一存储在 `data/library` 大池子中，相册仅作为逻辑分组（仅存储照片ID引用）。
  - **自动迁移**: 系统启动时会自动将旧版的文件夹式相册迁移到新的库结构中，原有照片不会丢失。
  - **去重机制**: 上传时通过 SHA-256 哈希自动检测重复文件，避免冗余存储。

### 新增功能 (Features)

- **照片库管理 (Photo Library)**:
  - 新增 `/admin/library` 独立管理页面。
  - 支持拖拽上传、上传进度条显示、按备注/地点搜索。
  - **照片编辑**: 支持在线 **向左/向右旋转** 照片，修改拍摄时间、地点名称和备注。
  - **Web 优化图**: 自动生成 1920px 宽度的 Web 优化版图片，提升加载速度和轮播性能。

- **相册管理增强**:
  - 新增 `/admin/albums` 独立相册管理页面。
  - **照片选择器**: 向相册添加照片时，支持从库中选择，并增加了 **全选** 功能，方便批量操作。
  - 一个照片可以加入多个相册，无需复制文件。

- **展示体验升级**:
  - **切换特效**: 首页播放器新增 4 种随机切换动画（淡入淡出、滑动、缩放、上推），视觉效果更生动。
  - **智能预加载**: 优化了下一张图片的预加载逻辑，减少卡顿。
  - **缓存自动刷新**: 编辑或旋转照片后，首页和管理页会自动刷新缩略图缓存，立即显示最新状态。

### 修复 (Fixes)

- 修复了旧数据迁移时的参数调用错误。
- 修复了旋转照片后浏览器缓存导致缩略图不更新的问题。
- 优化了相册加载性能，移除了导致超时的实时逆地理编码操作（改为上传时处理）。

## [v0.4.0] - 2025-11-28

### 新增功能 (Features)

- **节能休眠模式 (Sleep Mode)**:
  - **全屏夜间时钟**: 休眠时显示黑底大字时钟，包含秒、公历/农历日期、星期。
  - **深度节能**: 休眠期间自动销毁 YouTube 播放器、暂停所有轮播动画和网络请求，显著降低功耗。
  - **防烧屏保护**: 时钟位置每 5 分钟随机偏移。
  - **智能唤醒**: 休眠结束自动恢复直播和数据更新。

- **动态配置系统**:
  - 设置页面新增节能模式控制面板（开关及起止时间）。
  - 前端实现配置热更新，修改设置后无需刷新页面即可生效。

## [v0.3.0] - 2025-11-28

### 新增功能 (Features)

- **金融信息看板**:
  - 首页底部新增金融数据滚动展示栏，支持全球主要指数（如上证、纳斯达克、BTC等）的实时行情。
  - 新增个股详情轮播功能，支持显示个股实时价格、涨跌幅。
  - **个股双图表展示**: 
    - 左侧展示当日分时走势图（5分钟级）。
    - 右侧展示近1年日K线走势图。
    - 均支持在设置页面自定义指数列表和自选股列表。

- **智能生活信息**:
  - **农历与节气**: 首页左上角新增农历日期、干支纪年（如乙巳年）、生肖显示。
  - **实时天气与预报**: 
    - 集成 Open-Meteo API，显示实时温度和天气图标。
    - 新增未来 2、4、6 小时的天气预报。
    - 强制对齐北京时间，确保预报准确性。

- **设置增强**:
  - 新增 **金融数据设置** 模块：
    - 支持配置指数列表和自选股列表。
    - 支持自定义 **指数轮播速度** (Ticker Speed)。
    - 支持自定义 **个股切换间隔** (Stock Switch Interval)。
  - 设置页面底部增加悬浮保存栏，统一保存所有设置，提升用户体验。

### 优化 (Optimizations)

- **首页布局重构**:
  - 采用 "左侧多功能 + 右侧相册" 的布局结构。
  - 左侧分为：顶部生活信息栏、中部直播窗口（保持16:9）、底部金融看板。
  - 优化了日期时间的显示逻辑，日期在上，时间在下，并补全了秒显示 (HH:MM:SS)。
  
- **技术栈更新**:
  - 引入 `yfinance` 库用于获取金融数据。
  - 引入 `lunar-javascript` 用于前端农历转换。
  - 引入 `Chart.js` 用于绘制股票走势图。

## [v0.2.0] - 2023-12-XX (示例)

- 基础功能版本，包含 NASA 直播、本地相册轮播、基础设置等功能。
